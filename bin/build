#!/bin/bash

# Fail on errors
set -e

# If no theme argument was passed, use default
if [ -z "$1" ]; then
  theme="alpha"
else
  theme=$1
fi

# Delete dist folder and recreate it
yarn clean && mkdir dist/

# For each file in the theme folder...
for file in themes/$theme/*; do
  if [[ "$file" == *".ejs" ]]; then
    yarn render $file dist/$(basename "$file" .ejs).html
  fi
done

# Create css folder and copy CSS files
mkdir dist/css/
cp themes/$theme/css/*.css dist/css/

# For each file in the theme folder...
for file in themes/$theme/css/*; do
  if [[ "$file" == *".ejs" ]]; then
    yarn render $file dist/css/$(basename "$file" .ejs)
  fi
done

# Copy asset folders
cp -r themes/$theme/js/ dist/js/

# Format files
yarn format-dist
